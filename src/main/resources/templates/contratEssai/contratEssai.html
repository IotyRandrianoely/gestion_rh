<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org">
<head>
    <meta charset="UTF-8"/>
    <title>Proposer contrat d'essai</title>
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <style>
        :root{
            --bg:#f5f7fa; --text:#2c3e50; --sub:#4b5a6a;
            --card:#ffffff; --line:#e6ecf2;
            --primary:#3498db; --primary-d:#2980b9;
            --accent:#2ecc71; --accent-d:#27ae60;
            --danger:#e74c3c; --danger-d:#c0392b;
            --muted:#8aa0b2;
        }
        
        *{box-sizing:border-box;margin:0;padding:0}
        
        body{
            font-family:'Segoe UI',Arial,sans-serif; color:var(--text);
            background:var(--bg); padding:22px; max-width:800px; margin:0 auto; line-height:1.6;
        }

        /* ===== Header ===== */
        .page-header{
            background:linear-gradient(135deg, rgba(52,152,219,.12), rgba(46,204,113,.10));
            border:1px solid var(--line); border-radius:14px; padding:20px 24px; margin-bottom:20px;
            text-align:center;
        }
        
        .page-header h1{ 
            font-size:26px; margin-bottom:8px; letter-spacing:.3px; color:#243447;
        }
        
        .subtitle{ 
            color:var(--sub); font-size:14px; max-width:500px; margin:0 auto;
        }

        /* ===== Card / layout ===== */
        .card{
            background:var(--card); border:1px solid var(--line); border-radius:14px; padding:24px;
            box-shadow:0 6px 16px rgba(0,0,0,.06); margin-bottom:18px;
        }

        /* Form controls */
        .form-group{ 
            display:flex; flex-direction:column; gap:8px; margin-bottom:20px;
        }
        
        label{ 
            font-weight:800; color:#243447; font-size:14px; display:flex; align-items:center; gap:4px;
        }
        
        .required::after{
            content:" *"; color:var(--danger); font-weight:800;
        }
        
        input[type="text"], input[type="email"], input[type="number"], input[type="date"], textarea, select{
            width:100%; padding:12px 14px; border:1px solid #d7dde5; border-radius:10px; 
            font-size:14px; background:#fff; transition:border-color .2s, box-shadow .2s;
        }
        
        input:focus, select:focus, textarea:focus{
            border-color:#8ac4fb; box-shadow:0 0 0 4px rgba(52,152,219,.15); outline:none;
        }
        
        input[type="number"]{
            -moz-appearance:textfield;
        }
        input[type="number"]::-webkit-outer-spin-button,
        input[type="number"]::-webkit-inner-spin-button {
            -webkit-appearance: none;
            margin: 0;
        }

        /* Grid layout pour les champs */
        .form-grid{
            display:grid; grid-template-columns:1fr 1fr; gap:20px; margin-bottom:20px;
        }
        
        @media(max-width:600px){ 
            .form-grid{ grid-template-columns:1fr; gap:16px; }
        }

        /* Buttons */
        .actions{ 
            margin-top:28px; display:flex; gap:14px; flex-wrap:wrap; justify-content:center;
        }
        
        .btn{
            display:inline-block; padding:14px 22px; border-radius:10px; font-weight:800; font-size:14px;
            text-decoration:none; border:1px solid transparent; transition:transform .2s, box-shadow .2s, background .2s, border-color .2s;
            cursor:pointer; min-width:120px; text-align:center;
        }
        
        .btn-success{ 
            background:var(--accent); color:#fff; border:1px solid var(--accent);
        }
        .btn-success:hover{ 
            background:var(--accent-d); transform:translateY(-1px); box-shadow:0 8px 16px rgba(46,204,113,.2);
        }
        
        .btn-secondary{ 
            background:#fff; color:#3498db; border-color:#cfe2f7;
        }
        .btn-secondary:hover{ 
            background:#f3f8ff; border-color:#b7d5f6; transform:translateY(-1px);
        }

        /* Alerts */
        .alert{ 
            padding:14px 18px; border-radius:10px; border:1px solid; margin-bottom:16px; font-size:14px;
        }
        .alert-error{ 
            background:#fdecea; color:#a12622; border-color:#f3c3c0;
        }
        .alert-success{ 
            background:#eafaf1; color:#1b7f45; border-color:#c9eedc;
        }

        /* Form sections */
        .section-title{ 
            font-size:16px; font-weight:800; margin:24px 0 16px 0; color:#243447; 
            border-bottom:2px solid #eef6ff; padding-bottom:8px;
        }
        .section-title:first-of-type{
            margin-top:0;
        }

        /* Hidden input styling */
        input[type="hidden"] + .form-group{
            margin-top:0;
        }

        /* Responsive improvements */
        @media(max-width:480px){
            body{ padding:16px; }
            .card{ padding:20px; }
            .page-header{ padding:18px; }
            .page-header h1{ font-size:22px; }
            .actions{ flex-direction:column; align-items:stretch; }
            .btn{ min-width:auto; }
        }

        /* Loading state for submit button */
        .btn-success:disabled{
            background:#bdc3c7; cursor:not-allowed; transform:none;
        }
        .btn-success:disabled:hover{
            box-shadow:none; transform:none;
        }
    </style>
</head>
<body>
    <!-- ===== HEADER ===== -->
    <div class="page-header">
        <h1>Proposer un contrat d'essai</h1>
        <div class="subtitle">
            Définissez les conditions du contrat d'essai pour le candidat sélectionné. 
            Tous les champs sont obligatoires.
        </div>
    </div>

    <!-- ===== FORMULAIRE ===== -->
    <div class="card">
        <form th:action="@{/contratEssai/save}" method="post" onsubmit="return validateAndSubmit(this);">
            <input type="hidden" name="candidateId" id="candidateId" th:value="${candidateId != null ? candidateId : param.candidateId}" />

            <div class="section-title">Informations du contrat</div>
            
            <div class="form-group">
                <label for="dateDebut" class="required">Date de début</label>
                <input type="date" name="dateDebut" id="dateDebut" required/>
            </div>

            <div class="form-grid">
                <div class="form-group">
                    <label for="duree" class="required">Durée (en jours)</label>
                    <input type="number" name="duree" id="duree" required placeholder="ex: 90"/>
                </div>

                <div class="form-group">
                    <label for="salaire" class="required">Salaire (Ariary)</label>
                    <input type="number" name="salaire" id="salaire" required placeholder="ex: 1000000"/>
                </div>
            </div>

            <!-- Actions -->
            <div class="actions">
                <button type="submit" class="btn btn-success" id="submitBtn">
                    Envoyer la proposition
                </button>
                <a th:href="@{/candidats}" class="btn btn-secondary">Annuler</a>
            </div>
        </form>
    </div>

    <script>
        function validateAndSubmit(form) {
            const candidateId = document.getElementById('candidateId').value;
            const dateDebut = document.getElementById('dateDebut').value;
            const duree = parseInt(document.getElementById('duree').value, 10);
            const salaire = parseFloat(document.getElementById('salaire').value);
            const submitBtn = document.getElementById('submitBtn');

            // Validation côté client
            if (!candidateId || !dateDebut || !duree || isNaN(duree) || duree < 1 || isNaN(salaire) || salaire < 0) {
                alert('Veuillez remplir tous les champs requis avec des valeurs valides.');
                return false;
            }

            // Validation de la date (ne peut pas être dans le passé)
            const today = new Date();
            const startDate = new Date(dateDebut);
            today.setHours(0, 0, 0, 0);
            startDate.setHours(0, 0, 0, 0);

            if (startDate < today) {
                alert('La date de début ne peut pas être antérieure à aujourd\'hui.');
                return false;
            }

            // Validation durée raisonnable
            if (duree > 180) {
                alert('La durée ne peut pas dépasser 180 jours.');
                return false;
            }

            // Debug console pour vérifier l'envoi côté client
            console.log('Submitting contratEssai form', {
                candidateId: candidateId,
                dateDebut: dateDebut, 
                duree: duree, 
                salaire: salaire
            });

            // Désactiver le bouton pour éviter les double-clics
            submitBtn.disabled = true;
            submitBtn.textContent = 'Envoi en cours...';

            // Réactiver le bouton après un délai en cas d'erreur
            setTimeout(() => {
                submitBtn.disabled = false;
                submitBtn.textContent = 'Envoyer la proposition';
            }, 5000);

            return true;
        }

        // Amélioration UX: focus automatique sur le premier champ
        document.addEventListener('DOMContentLoaded', function() {
            const firstInput = document.getElementById('dateDebut');
            if (firstInput) {
                firstInput.focus();
            }

            // Définir la date minimale à aujourd'hui
            const today = new Date().toISOString().split('T')[0];
            document.getElementById('dateDebut').setAttribute('min', today);
        });
    </script>
</body>
</html>