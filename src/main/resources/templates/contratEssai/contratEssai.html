<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org">
<head>
    <meta charset="UTF-8"/>
    <title>Proposer contrat d'essai</title>
</head>
<body>
<h1>Proposer un contrat d'essai</h1>

<form th:action="@{/contratEssai/save}" method="post" onsubmit="return validateAndSubmit(this);">
    <input type="hidden" name="candidateId" id="candidateId" th:value="${candidateId != null ? candidateId : param.candidateId}" />

    <!-- <p>
        <label for="posteId">Poste :</label>
        <select name="posteId" id="posteId" required>
            <option value="">Choisir</option>
            <option th:each="p : ${postes}"
                    th:value="${p.id}"
                    th:text="${p.profil}"
                    th:selected="${(candidate != null and candidate.annonce != null and candidate.annonce.poste != null) ? (p.id == candidate.annonce.poste.id) : (param.posteId != null ? p.id == #numbers.parseInteger(param.posteId) : false)}">
                Poste
            </option>
        </select>
    </p> !-->

    <p>
        <label for="dateDebut">Date de début :</label>
        <input type="date" name="dateDebut" id="dateDebut" required/>
    </p>

    <p>
        <label for="duree">Durée (jours) :</label>
        <input type="number" name="duree" id="duree" min="1" required/>
    </p>

    <p>
        <label for="salaire">Salaire :</label>
        <input type="number" name="salaire" id="salaire" step="0.01" required/>
    </p>

    <!-- <p>
        <label for="conditions">Conditions :</label><br/>
        <textarea name="conditions" id="conditions" rows="4" cols="50"></textarea>
    </p> -->

    <p>
        <button type="submit">Envoyer la proposition</button>
        <a th:href="@{/candidats}">Annuler</a>
    </p>
</form>

<script>
function validateAndSubmit(form) {
    const posteId = document.getElementById('posteId').value;
    const dateDebut = document.getElementById('dateDebut').value;
    const duree = parseInt(document.getElementById('duree').value, 10);
    const salaire = parseFloat(document.getElementById('salaire').value);

    // debug console pour vérifier l'envoi côté client
    console.log('Submitting contratEssai form', {
        candidateId: document.getElementById('candidateId').value,
        posteId, dateDebut, duree, salaire
    });

    if (!posteId || !dateDebut || !duree || isNaN(salaire)) {
        alert('Veuillez remplir tous les champs requis.');
        return false;
    }
    // laisser le navigateur soumettre le form (application/x-www-form-urlencoded)
    return true;
}
</script>
</body>
</html>