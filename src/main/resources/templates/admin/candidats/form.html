<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org">
<head>
    <title th:text="${candidat.id == null ? 'Nouveau candidat' : 'Modifier candidat'}"></title>
    <style>
        body { font-family: Arial, sans-serif; margin: 20px; }
        .form-group { margin-bottom: 15px; }
        label { display: block; margin-bottom: 5px; font-weight: bold; }
        input, select, textarea { width: 100%; padding: 8px; border: 1px solid #ddd; border-radius: 4px; box-sizing: border-box; }
        textarea { height: 100px; resize: vertical; }
        .btn { padding: 10px 20px; margin: 5px; text-decoration: none; color: white; border: none; border-radius: 4px; cursor: pointer; }
        .btn-success { background-color: #28a745; }
        .btn-secondary { background-color: #6c757d; }
        .required { color: red; }
        .alert { padding: 10px; margin: 10px 0; border-radius: 4px; }
        .alert-error { background-color: #f8d7da; color: #721c24; border: 1px solid #f5c6cb; }
        .alert-success { background-color: #d4edda; color: #155724; border: 1px solid #c3e6cb; }
    </style>
</head>
<body>
    <h2 th:text="${candidat.id == null ? 'Nouveau candidat' : 'Modifier candidat'}"></h2>

    <!-- Messages d'erreur et de succès -->
    <div th:if="${error}" class="alert alert-error" th:text="${error}"></div>
    <div th:if="${success}" class="alert alert-success" th:text="${success}"></div>

    <form th:action="@{/admin/candidats}" method="post" th:object="${candidat}">
        <input type="hidden" th:field="*{id}" />

        <div class="form-group">
            <label for="annonce">Annonce <span class="required">*</span></label>
            <select th:field="*{annonce.id}" id="annonce" required>
                <option value="">-- Sélectionner une annonce --</option>
                <option th:each="a : ${annonces}"
                        th:value="${a.id}"
                        th:text="${a.profil + ' - ' + a.description}">
                </option>
            </select>
        </div>

        <div class="form-group">
            <label for="nom">Nom <span class="required">*</span></label>
            <input type="text" th:field="*{nom}" id="nom" required maxlength="40"/>
        </div>

        <div class="form-group">
            <label for="prenom">Prénom <span class="required">*</span></label>
            <input type="text" th:field="*{prenom}" id="prenom" required maxlength="40"/>
        </div>

        <div class="form-group">
            <label for="email">Email <span class="required">*</span></label>
            <input type="email" th:field="*{email}" id="email" required maxlength="40"/>
        </div>

        <div class="form-group">
            <label for="age">Âge <span class="required">*</span></label>
            <input type="number" th:field="*{age}" id="age" required min="16" max="70"/>
        </div>

        <div class="form-group">
            <label for="genre">Genre <span class="required">*</span></label>
            <select th:field="*{genre}" id="genre" required>
                <option value="">-- Sélectionner --</option>
                <option value="1">Homme</option>
                <option value="2">Femme</option>
            </select>
        </div>

        <!-- *** NOUVEAU CHAMP DIPLOME *** -->
        <div class="form-group">
            <label for="diplome">Diplôme <span class="required">*</span></label>
            <select th:field="*{diplome.id}" id="diplome" required>
                <option value="">-- Sélectionner un diplôme --</option>
                <option th:each="d : ${diplomes}"
                        th:value="${d.id}"
                        th:text="${d.nomDiplome}">
                </option>
            </select>
        </div>

        <div class="form-group">
            <label for="adresse">Adresse</label>
            <input type="text" th:field="*{adresse}" id="adresse" maxlength="60"/>
        </div>

        <div class="form-group">
            <label for="anneesExperience">Années d'expérience <span class="required">*</span></label>
            <input type="number" th:field="*{anneesExperience}" id="anneesExperience" required min="0" max="50"/>
        </div>

        <div class="form-group">
            <label for="lettreMotivation">Lettre de motivation</label>
            <textarea th:field="*{lettreMotivation}" id="lettreMotivation" maxlength="300"></textarea>
        </div>

        <div class="form-group">
            <label for="cv">CV (chemin fichier)</label>
            <input type="text" th:field="*{cv}" id="cv" maxlength="60"/>
        </div>

        <div class="form-group">
            <label for="dateCandidature">Date de candidature</label>
            <input type="date" th:field="*{dateCandidature}" id="dateCandidature"/>
        </div>

        <button type="submit" class="btn btn-success">Enregistrer</button>
        <a th:href="@{/admin/candidats}" class="btn btn-secondary">Annuler</a>
    </form>

    <script>
        // Validation côté client
        document.querySelector('form').addEventListener('submit', function(e) {
            const annonce = document.getElementById('annonce').value;
            const nom = document.getElementById('nom').value.trim();
            const prenom = document.getElementById('prenom').value.trim();
            const email = document.getElementById('email').value.trim();
            const age = document.getElementById('age').value;
            const genre = document.getElementById('genre').value;
            const diplome = document.getElementById('diplome').value; // *** NOUVEAU ***
            const anneesExperience = document.getElementById('anneesExperience').value;
            
            if (!annonce || !nom || !prenom || !email || !age || !genre || !diplome || !anneesExperience) {
                e.preventDefault();
                alert('Veuillez remplir tous les champs obligatoires');
                return false;
            }
            
            if (age < 16 || age > 70) {
                e.preventDefault();
                alert('L\'âge doit être entre 16 et 70 ans');
                return false;
            }
            
            if (anneesExperience < 0) {
                e.preventDefault();
                alert('Les années d\'expérience ne peuvent pas être négatives');
                return false;
            }
        });
    </script>
</body>
</html>